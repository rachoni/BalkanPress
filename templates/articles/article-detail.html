{% extends 'common/base.html' %}
{% load article_extras %}

{% block title %}
	{{ article.title }} - BalkanPress
{% endblock %}

{% block content %}
	<div class="container">
        <div class="mb-3">
            <a href="{% url 'articles:list' %}" class="btn btn-outline-secondary btn-sm">
                Back to Articles
            </a>
        </div>
        <article class="card shadow-sm mb-4">
            {% if article.featured_image %}
                <img src="{{ article.featured_image.url }}" class="card-img-top" alt="{{ article.title }}">
            {% endif %}

            <div class="card-body">
                <h1 class="h3 mb-2">
                    {{ article.title }}
                </h1>

                <p class="text-muted small mb-3">
                    {{ article.created_at|date:"M d, Y" }} | {{ article.content|reading_time }} min read | {{ article.content|word_count }} words
                </p>

                <p class="lead mb-4">
                    {{ article.summary }}
                </p>

                <div class="mb-4">
                    {{ article.content|linebreaks }}
                </div>

                <div class="mb-3">
                    {% for category in article.categories.all %}
                    	<a href="{% url 'categories:category-articles' slug=category.slug %}" class="badge text-bg-secondary text-decoration-none">
                            {{ category.name }}
                        </a>
                    {% endfor %}
                </div>

                <div class="mb-4">
                    {% for tag in article.tags.all %}
                    	<a href="{% url 'tags:tag-articles' slug=tag.slug %}" class="badge text-bg-light border text-decoration-none">
                            #{{ tag.name }}
                        </a>
                    {% empty %}
                    	<span class="text-muted small">
                        No tags
                        </span>
                    {% endfor %}
                </div>

                <div class="d-flex gap-2">
                    <a href="{% url 'articles:edit' slug=article.slug %}" class="btn btn-warning btn-sm">
                        Edit
                    </a>
                    <a href="{% url 'articles:delete' slug=article.slug %}" class="btn btn-danger btn-sm">
                        Delete
                    </a>
                </div>
            </div>
        </article>

        <section class="mb-4">
            <h2 class="h5 mb-3">
                Comments ({{ comments|length }})
            </h2>

            {% if comments %}
            	<div class="vstack gap-3">
                    {% for comment in comments %}
                    	<div class="border rounded p-3 bg-light">
                            <div class="d-flex justify-content-between mb-2">
                                <strong>
                                    {{ comment.author_name }}
                                </strong>
                                <span class="text-muted small">
                                    {{ comment.created_at|date:"M d, Y H:i" }}
                                </span>
                            </div>
                            <p class="mb-0">
                                {{ comment.body|linebreaks }}
                            </p>
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <p class="text-muted mb-0">
                    No comments yet.
                </p>
            {% endif %}
        </section>

        <section>
            <h2 class="h5 mb-3">
                Leave a Comment
            </h2>

            <form method="post" class="card card-body shadow-sm">
                {% csrf_token %}

                {% if form.non_field_errors %}
                	<div class="alert alert-danger py-2">
                        {{ form.non_field_errors }}
                    </div>
                {% endif %}

                <div class="mb-3">
                    <label for="{{ form.author_name.id_for_label }}" class="form-label">
                        {{ form.author_name.label }}
                    </label>
                    {{ form.author_name }}
                    {% if form.author_name.help_text %}
                    	<div class="form-text">
                            {{ form.author_name.help_text }}
                        </div>
                    {% endif %}
                    {% for error in form.author_name.errors %}
                    	<div class="text-danger small">
                            {{ error }}
                        </div>
                    {% endfor %}
                </div>

                <div class="mb-3">
                    <label for="{{ form.body.id_for_label }}" class="form-label">
                        {{ form.body.label }}
                    </label>
                    {{ form.body }}
                    {% if form.body.help_text %}
                    	<div class="form-text">
                            {{ form.body.help_text }}
                        </div>
                    {% endif %}
                    {% for error in form.body.errors %}
                	    <div class="text-danger small">
                            {{ error }}
                        </div>
                    {% endfor %}
                </div>

                <button type="submit" class="btn btn-primary">
                    Post Comment
                </button>
            </form>
        </section>
    </div>
{% endblock %}